#
# This file is managed by Chef.
# Do NOT modify this file directly.
#

service {
  user root
  group root
  paxos-single-replica-limit 1
  pidfile /var/run/aerospike/asd.pid
  proto-fd-max 15000
  work-directory /opt/aerospike
  nsup-period 60

}

logging {
  file /var/log/aerospike/aerospike.log {
    context any info
  }

}

mod-lua {
  user-path /opt/aerospike/usr/udf/lua
  system-path /opt/aerospike/sys/udf/lua

}

network {
  service {
    address <%= node['aerospike']['config']['network']['service']['address'] %>
    port    <%= node['aerospike']['config']['network']['service']['port'] %>
  }

  heartbeat {
    mode     <%= node['aerospike']['config']['network']['service']['mode'] %>
    interval <%= node['aerospike']['config']['network']['service']['interval'] %>
    timeout  <%= node['aerospike']['config']['network']['service']['timeout'] %>
    port     <%= node['aerospike']['config']['network']['heartbeat']['port'] %>
    address  <%= node['aerospike']['config']['network']['heartbeat']['address'] %>

    <% node['aerospike']['config']['nodes'].each do |i, config| %>
    mesh-seed-address-port <%= i %> <%= node['aerospike']['config']['network']['heartbeat']['port'] %>
    <% end %>

    }
}

namespace userdb {
  replication-factor 2
  memory-size 22G
  default-ttl 30d
  storage-engine device {
    device /dev/nvme0n1
    write-block-size 1024K
  }
}
